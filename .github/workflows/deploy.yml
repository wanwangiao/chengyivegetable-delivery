name: Auto Deploy to Railway

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      reason:
        description: 'æ‰‹å‹•è§¸ç™¼éƒ¨ç½²åŸå› '
        required: false
        default: 'æ‰‹å‹•è§¸ç™¼éƒ¨ç½²'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
      
    - name: è¨­ç½®Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: æª¢æŸ¥èªæ³•
      run: |
        echo "ğŸ” æª¢æŸ¥ä¸»è¦æ–‡ä»¶èªæ³•..."
        node -c src/server.js || exit 1
        echo "âœ… èªæ³•æª¢æŸ¥é€šé"
        
    - name: è§¸ç™¼Railwayéƒ¨ç½²
      run: |
        echo "ğŸš€ è§¸ç™¼Railwayé‡æ–°éƒ¨ç½²..."
        echo "éƒ¨ç½²åŸå› : ${{ github.event.inputs.reason || 'è‡ªå‹•è§¸ç™¼' }}"
        echo "æäº¤ä¿¡æ¯: ${{ github.event.head_commit.message }}"
        echo "âœ… GitHub Actionsè§¸ç™¼æˆåŠŸï¼ŒRailwayå°‡è‡ªå‹•éƒ¨ç½²"
        
    - name: éƒ¨ç½²é€šçŸ¥
      run: |
        echo "ğŸ“Š éƒ¨ç½²ä¿¡æ¯:"
        echo "- åˆ†æ”¯: ${{ github.ref_name }}"
        echo "- æäº¤: ${{ github.sha }}"
        echo "- æ™‚é–“: $(date)"
        echo "- Railway URL: https://chengyivegetable-production-7b4a.up.railway.app/"