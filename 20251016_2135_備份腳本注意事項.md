# 備份腳本使用注意事項

**建立日期**: 2025-10-16 21:35

---

## ⚠️ 本地環境限制

### PostgreSQL 工具未安裝

本地 Windows 環境未安裝 PostgreSQL 客戶端工具 (`pg_dump`),因此無法直接執行 `scripts/manual-backup.sh`。

### 兩種解決方案

#### 方案 1: 使用 Railway Dashboard (推薦)

Railway 本身提供完整的備份功能:

1. **自動備份** (已建立設定指南)
   - 位置: Railway Dashboard → PostgreSQL 服務 → Backups
   - 設定每日自動備份
   - 保留 7 天
   - **這是最推薦的方案**

2. **手動備份**
   - 在 Railway Dashboard 點擊 "Create Backup Now"
   - 即時建立備份快照
   - 可隨時下載或恢復

#### 方案 2: 安裝 PostgreSQL 客戶端工具

如果需要在本地執行備份腳本:

**選項 A: 安裝完整 PostgreSQL**
```bash
# 使用 Chocolatey
choco install postgresql

# 或下載官方安裝檔
# https://www.postgresql.org/download/windows/
```

**選項 B: 只安裝客戶端工具**
```bash
# 使用 Scoop
scoop install postgresql

# 驗證安裝
pg_dump --version
```

安裝完成後,`scripts/manual-backup.sh` 即可正常運作。

---

## ✅ 推薦的備份策略

### 生產環境 (Railway)

**主要備份**: Railway 自動備份
- ✅ 每日 03:00 UTC (台灣 11:00)
- ✅ 保留 7 天
- ✅ 可在 Dashboard 一鍵恢復
- ✅ 不需要本地工具

**補充備份**: 重要更新前手動備份
- 在 Railway Dashboard 手動觸發
- 在重大功能部署前執行
- 在資料庫 Migration 前執行

### 開發環境 (本地)

開發環境通常不需要備份,因為:
- 資料可隨時重新生成
- 使用 Prisma Seed 填充測試資料
- 可從 Railway 匯入生產資料 (如需要)

---

## 📋 使用 Railway 備份的步驟

### 建立備份

1. 登入 Railway: https://railway.app/
2. 選擇專案: `chengyivegetable`
3. 點擊 **PostgreSQL** 服務
4. 切換到 **Backups** 標籤
5. 點擊 **"Create Backup Now"** 或類似按鈕
6. 等待完成 (通常 10-30 秒)

### 恢復備份

1. 在 **Backups** 標籤中
2. 找到要恢復的備份
3. 點擊該備份旁的 **"Restore"** 或選單按鈕
4. 確認恢復操作
5. 等待完成

⚠️ **注意**: 恢復備份會覆蓋現有資料!

### 下載備份 (可選)

如果需要將備份下載到本地:

1. 在 Railway 備份列表中
2. 點擊備份旁的下載圖示或選單
3. 選擇 "Download Backup"
4. 儲存 `.sql` 或 `.dump` 檔案

---

## 🔄 替代的本地備份方法

如果真的需要在本地執行備份,但不想安裝 PostgreSQL:

### 方法 1: 使用 Docker

```bash
# 使用 PostgreSQL Docker 容器執行 pg_dump
docker run --rm postgres:15 pg_dump "$DATABASE_URL" > backup.sql
```

### 方法 2: 使用 Railway CLI

```bash
# Railway CLI 可能支援資料庫操作 (需確認)
railway run pg_dump $DATABASE_URL > backup.sql
```

### 方法 3: 使用 Prisma

```bash
# Prisma 不直接支援備份,但可匯出資料
npx prisma db pull
# 這會更新 schema.prisma,但不會備份資料
```

---

## 📊 備份驗證清單

完成 Railway 備份設定後,請確認:

- [ ] Railway PostgreSQL 服務可以找到
- [ ] Backups 標籤可以開啟
- [ ] 自動備份已啟用
- [ ] 已手動測試一次備份
- [ ] 備份列表中有至少 1 個成功記錄
- [ ] 知道如何恢復備份

---

## 🎯 結論

**不需要在本地安裝 PostgreSQL 客戶端工具**

Railway 內建的備份功能已經足夠完善:
- ✅ 自動化備份排程
- ✅ 簡單的恢復流程
- ✅ 可視化管理介面
- ✅ 不需要額外工具

`scripts/manual-backup.sh` 腳本保留在專案中,供未來有需要時使用。

---

**下一步**: 完成 Railway Dashboard 的自動備份設定即可! 📋
