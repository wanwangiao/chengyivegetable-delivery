# 誠憶鮮蔬系統功能測試清單

> 📋 測試日期：______
> 👤 測試人員：______
> 🔗 測試環境：
> - 前端商城：https://chengyivegetable-production-7b4a.up.railway.app/
> - 管理後台：https://chengyivegetable-production-7b4a.up.railway.app/admin
> - 外送員端：https://chengyivegetable-driver-production.up.railway.app/
> - API 端點：https://chengyivegetable-api-production.up.railway.app/

---

## 📱 一、客戶商城功能測試

### 1.1 首頁商品瀏覽
- [ ] 頁面正常載入，無報錯
- [ ] 商品列表正確顯示（圖片、名稱、價格、庫存）
- [ ] 商品圖片載入正常（Cloudinary 高解析度）
- [ ] 分類篩選功能正常（全部商品、安心精選、每日推薦等）
- [ ] 搜尋功能正常（可搜尋商品名稱）
- [ ] 庫存狀態正確顯示
- [ ] 低庫存商品有警示顯示
- [ ] 固定價格商品顯示正確價格
- [ ] 秤重商品顯示「依秤重計價」提示
- [ ] 商品卡片點擊可開啟詳情彈窗

### 1.2 營業狀態與時間判斷
- [ ] 營業狀態橫幅正確顯示
- [ ] 07:30-10:00 時段顯示「當日訂單開放」
- [ ] 10:00-14:00 時段顯示「備貨中（當日訂單截止）」
- [ ] 14:00-23:59 時段顯示「隔天預訂開放」
- [ ] 週一顯示「店休日」
- [ ] 週四顯示「店休日」
- [ ] 點擊營業狀態可開啟行事曆

### 1.3 商品詳情彈窗
- [ ] 詳情彈窗正確開啟
- [ ] 顯示完整商品描述
- [ ] 顯示商品單位和單位提示
- [ ] 顯示正確價格（今日/明日）
- [ ] 數量選擇器正常運作（+/-）
- [ ] 商品選項（如有）正確顯示
- [ ] 「加入購物車」按鈕功能正常
- [ ] 關閉按鈕功能正常

### 1.4 購物車系統
- [ ] 加入商品後購物車圖示更新數量
- [ ] 購物車側邊欄/底部抽屜正常開啟
- [ ] 購物車列表正確顯示所有商品
- [ ] 商品數量可修改（+/-）
- [ ] 刪除商品功能正常
- [ ] 小計金額計算正確
- [ ] 運費計算正確（NT$200 免運，否則 NT$60）
- [ ] 總金額計算正確（小計 + 運費）
- [ ] 免運進度提示正確顯示
- [ ] 購物車資料刷新後仍保留（LocalStorage）
- [ ] 清空購物車功能正常

### 1.5 結帳流程
- [ ] 點擊「前往結帳」按鈕正常跳轉
- [ ] 結帳頁面正確載入
- [ ] 訂單摘要表格正確顯示
- [ ] 收件人姓名欄位可輸入
- [ ] 聯絡電話欄位可輸入且有格式驗證
- [ ] 配送地址欄位可輸入
- [ ] 備註事項欄位可輸入（選填）
- [ ] 付款方式選項正常（現金、銀行轉帳、LINE Pay、信用卡）
- [ ] 表單驗證功能正常（必填欄位提示）
- [ ] 手機號碼格式驗證（09xxxxxxxx）
- [ ] 客戶資料自動保存到 LocalStorage
- [ ] 下次結帳時自動填入上次的資料

### 1.6 訂單提交
- [ ] 點擊「送出訂單」按鈕無錯誤
- [ ] 提交後顯示成功訊息
- [ ] 顯示訂單編號
- [ ] 訂單提交後購物車自動清空
- [ ] 可選擇跳轉到訂單追蹤頁面

### 1.7 訂單追蹤
- [ ] 訂單追蹤頁面正常載入
- [ ] 手機號碼輸入欄位可輸入
- [ ] 點擊「查詢訂單」按鈕功能正常
- [ ] 查詢後正確顯示該電話的所有訂單
- [ ] 訂單列表顯示正確資訊（編號、狀態、金額、時間）
- [ ] 點擊訂單可展開詳細資訊
- [ ] 訂單詳情顯示完整（收件人、電話、地址、商品明細）
- [ ] 訂單狀態正確顯示（待確認/包裝中/包裝完成/配送中/已送達/待解決/已取消）
- [ ] 狀態時間軸正確顯示 7 個階段
- [ ] 當前狀態高亮顯示
- [ ] 狀態歷程記錄正確顯示（時間、備註）

### 1.8 LINE 整合（如已設定）
- [ ] LIFF 自動登入功能正常
- [ ] 顯示 LINE 使用者頭像和名稱
- [ ] 下單時自動關聯 LINE 帳號
- [ ] 訂單建立後收到 LINE 通知
- [ ] 訂單狀態變更時收到 LINE 通知

### 1.9 響應式設計
- [ ] 桌面版顯示正常
- [ ] 平板版顯示正常
- [ ] 手機版顯示正常
- [ ] 購物車在不同尺寸下正常顯示
- [ ] 所有按鈕在手機上可點擊

### 1.10 效能與體驗
- [ ] 頁面載入速度快（< 3 秒）
- [ ] 圖片載入順暢
- [ ] 滾動順暢無卡頓
- [ ] 無控制台錯誤訊息
- [ ] 動畫效果流暢

---

## 🔧 二、管理後台功能測試

### 2.1 登入系統
- [ ] 登入頁面正常載入
- [ ] 帳號欄位可輸入
- [ ] 密碼欄位可輸入且遮蔽
- [ ] 登入按鈕功能正常
- [ ] 錯誤帳密顯示錯誤訊息
- [ ] 正確帳密可成功登入
- [ ] 登入後自動跳轉到儀表板
- [ ] JWT Token 正確儲存到 LocalStorage
- [ ] 未登入時自動重定向到登入頁

### 2.2 儀表板
- [ ] 儀表板頁面正常載入
- [ ] 快速導航卡片正確顯示
- [ ] 點擊「訂單管理」跳轉正確
- [ ] 點擊「商品管理」跳轉正確
- [ ] 點擊「配送監控」跳轉正確
- [ ] 點擊「帳號管理」跳轉正確
- [ ] 點擊「系統設定」跳轉正確
- [ ] 統計數據正確顯示（如有）

### 2.3 訂單管理列表
- [ ] 訂單列表頁面正常載入
- [ ] 訂單列表正確顯示
- [ ] 統計卡片顯示正確（總訂單數、各狀態分布）
- [ ] 訂單表格欄位完整（訂單號、聯絡人、電話、地址、狀態、金額、時間）
- [ ] 訂單狀態徽章正確顯示顏色
- [ ] 點擊訂單可跳轉到詳情頁
- [ ] 搜尋功能正常（如有）
- [ ] 分頁功能正常（如有）
- [ ] 狀態篩選功能正常（如有）

### 2.4 訂單詳情頁
- [ ] 訂單詳情頁正常載入
- [ ] 訂單編號正確顯示
- [ ] 建立時間正確顯示
- [ ] 訂單狀態徽章正確顯示
- [ ] 收件資訊完整（聯絡人、電話、地址、備註）
- [ ] 金額資訊完整（付款方式、小計、運費、總額）
- [ ] 商品明細表正確顯示所有商品
- [ ] 商品數量、單價、小計計算正確
- [ ] 狀態歷程表正確顯示所有變更記錄
- [ ] 狀態調整下拉選單功能正常
- [ ] 可輸入備註說明
- [ ] 點擊「更新狀態」按鈕功能正常
- [ ] 更新後狀態立即改變
- [ ] 更新後歷程記錄新增一筆
- [ ] 司機資訊正確顯示（已認領/待認領）
- [ ] 返回按鈕功能正常

### 2.5 商品管理中心
- [ ] 商品管理頁面正常載入（Material-UI）
- [ ] 商品列表正確顯示
- [ ] 統計卡片正確顯示（全部商品、上架中、下架、低庫存、固定價格、秤重商品）
- [ ] 商品表格欄位完整（圖片、名稱、分類、價格、庫存、狀態、操作）
- [ ] 商品圖片正確顯示
- [ ] 搜尋功能正常
- [ ] 分類篩選功能正常
- [ ] 上架/下架篩選功能正常

### 2.6 商品新增
- [ ] 點擊「新增商品」按鈕開啟對話框
- [ ] 對話框正確顯示
- [ ] 商品名稱欄位可輸入
- [ ] 分類下拉選單功能正常
- [ ] 描述欄位可輸入
- [ ] 單位欄位可輸入
- [ ] 單位提示欄位可輸入
- [ ] 今日價格欄位可輸入數字
- [ ] 明日價格欄位可輸入數字
- [ ] 庫存數量欄位可輸入數字
- [ ] 排序值欄位可輸入數字
- [ ] 上架狀態切換按鈕功能正常
- [ ] 秤重商品切換按鈕功能正常
- [ ] 秤重單價欄位（開啟秤重時）可輸入
- [ ] 表單驗證功能正常（必填欄位提示）
- [ ] 點擊「儲存」按鈕功能正常
- [ ] 新增成功後列表自動更新
- [ ] 新增成功後顯示成功訊息

### 2.7 商品編輯
- [ ] 點擊「編輯」按鈕開啟對話框
- [ ] 對話框正確載入現有資料
- [ ] 所有欄位可正常修改
- [ ] 修改後點擊「儲存」功能正常
- [ ] 儲存成功後列表自動更新
- [ ] 儲存成功後顯示成功訊息
- [ ] 點擊「取消」按鈕功能正常

### 2.8 商品圖片上傳
- [ ] 點擊「上傳圖片」按鈕開啟文件選擇
- [ ] 可選擇圖片檔案（jpg, png, webp）
- [ ] 上傳進度顯示正常
- [ ] 上傳成功後圖片立即顯示
- [ ] 圖片儲存到 Cloudinary
- [ ] 圖片格式為 WebP
- [ ] 圖片尺寸為 1200x1200（或比例保持）
- [ ] 圖片品質良好

### 2.9 商品選項管理
- [ ] 商品選項區塊正確顯示
- [ ] 點擊「新增選項」可新增一組選項
- [ ] 選項名稱欄位可輸入
- [ ] 選項加價欄位可輸入
- [ ] 可新增多個選項
- [ ] 點擊「刪除」可刪除選項
- [ ] 選項隨商品一起儲存

### 2.10 價格管理控制台
- [ ] 今日/明日價格狀態正確顯示
- [ ] 「同步明日價格」按鈕功能正常
- [ ] 點擊同步後明日價格更新為今日價格
- [ ] 「檢查預訂單價格變動」按鈕功能正常
- [ ] 點擊檢查後顯示變動報告（如有變動）
- [ ] 價格變動報告資訊完整（商品、數量、價差、百分比）
- [ ] 價格變動超過閾值自動發送 LINE 通知（如已設定）
- [ ] 「複製今日價至明日價」功能正常

### 2.11 商品批量操作
- [ ] CSV 匯出功能正常
- [ ] 匯出的 CSV 格式正確
- [ ] CSV 包含所有商品資料
- [ ] CSV 匯入功能正常
- [ ] 可選擇 CSV 檔案上傳
- [ ] 匯入成功後列表更新
- [ ] 匯入失敗顯示錯誤訊息
- [ ] 批量更新功能正常（如有）
- [ ] 重新排序功能正常（如有）

### 2.12 商品刪除
- [ ] 點擊「刪除」按鈕顯示確認對話框
- [ ] 確認刪除後商品從列表移除
- [ ] 刪除成功後顯示成功訊息
- [ ] 取消刪除功能正常

### 2.13 商品上架/下架切換
- [ ] 點擊切換按鈕功能正常
- [ ] 狀態立即改變
- [ ] 下架商品在前台不顯示
- [ ] 上架商品在前台顯示

### 2.14 配送監控地圖
- [ ] 配送監控頁面正常載入
- [ ] 地圖正確顯示（Leaflet）
- [ ] 監控指標卡片正確顯示（線上外送員、待配送、配送中）
- [ ] 最後更新時間正確顯示
- [ ] 外送員位置標記正確顯示在地圖上
- [ ] 訂單位置標記正確顯示在地圖上
- [ ] 不同狀態訂單使用不同顏色標記
- [ ] 點擊標記可顯示詳細資訊
- [ ] 地圖可拖曳和縮放
- [ ] 自動輪詢功能正常（每 60 秒）
- [ ] 手動刷新按鈕功能正常
- [ ] 刷新後數據更新

### 2.15 帳號管理（如有）
- [ ] 帳號管理頁面正常載入
- [ ] 使用者列表正確顯示
- [ ] 可新增使用者
- [ ] 可編輯使用者
- [ ] 可停用/啟用使用者
- [ ] 角色設定功能正常（ADMIN/DRIVER/CUSTOMER）
- [ ] 密碼修改功能正常

### 2.16 系統設定（如有）
- [ ] 系統設定頁面正常載入
- [ ] 商店名稱可修改
- [ ] 商店電話可修改
- [ ] 營業時間設定可修改
- [ ] 價格變動閾值可修改
- [ ] 價格確認超時時間可修改
- [ ] LINE 通知開關可切換
- [ ] 儲存設定功能正常
- [ ] 設定立即生效

### 2.17 營業時間管理
- [ ] 營業時間設定頁面正常載入
- [ ] 固定休息日設定可修改（週一、週四）
- [ ] 訂單截止時間可修改
- [ ] 預訂開始時間可修改
- [ ] 當日訂單開始時間可修改
- [ ] 可新增特殊日期（臨時休假）
- [ ] 可新增特殊日期（臨時營業）
- [ ] 可刪除特殊日期
- [ ] 行事曆顯示正確
- [ ] 特殊日期在行事曆上標記清楚

### 2.18 後台通用功能
- [ ] 導航選單功能正常
- [ ] 麵包屑導航正確顯示
- [ ] 登出按鈕功能正常
- [ ] 登出後清除 Token
- [ ] 登出後跳轉到登入頁
- [ ] 無控制台錯誤
- [ ] 頁面載入速度快

---

## 🚚 三、外送員 App 功能測試

### 3.1 登入系統
- [ ] 登入頁面正常載入
- [ ] 電話號碼欄位可輸入
- [ ] 密碼欄位可輸入且遮蔽
- [ ] 登入按鈕功能正常
- [ ] 錯誤帳密顯示錯誤訊息
- [ ] 正確帳密可成功登入
- [ ] 登入後自動跳轉到儀表板
- [ ] JWT Token 正確儲存（Web: LocalStorage, RN: AsyncStorage）

### 3.2 司機狀態管理
- [ ] 司機狀態晶片正確顯示當前狀態
- [ ] 點擊可開啟狀態選擇器
- [ ] 可切換到「上線可接單」
- [ ] 可切換到「配送中」
- [ ] 可切換到「下線休息」
- [ ] 切換後狀態立即改變
- [ ] 切換後 API 更新成功
- [ ] 下線時不會收到新訂單推播

### 3.3 GPS 定位追蹤
- [ ] 首次開啟時請求定位權限
- [ ] 允許定位後可正常取得座標
- [ ] 當前位置正確顯示（緯度、經度）
- [ ] 位置每 30 秒自動更新
- [ ] 位置變化時自動上報到後端
- [ ] 位置陳舊檢測功能正常（10 分鐘無更新顯示警告）
- [ ] 定位精度顯示正常
- [ ] 關閉定位時顯示提示訊息

### 3.4 可接訂單標籤
- [ ] 可接訂單標籤正確顯示
- [ ] 訂單列表正確載入
- [ ] 訂單卡片顯示完整資訊（訂單號、聯絡人、地址、金額）
- [ ] 訂單金額正確顯示
- [ ] 配送日期正確顯示
- [ ] 點擊訂單可展開詳細資訊
- [ ] 訂單詳情顯示商品明細
- [ ] 「認領訂單」按鈕功能正常
- [ ] 認領成功後訂單移至「配送中」標籤
- [ ] 認領成功後顯示成功訊息
- [ ] 下拉刷新功能正常
- [ ] 無訂單時顯示空狀態提示

### 3.5 批次推薦功能
- [ ] 「批次建議」按鈕正確顯示
- [ ] 點擊按鈕載入批次推薦
- [ ] 推薦批次列表正確顯示
- [ ] 每個批次顯示訂單數量和總金額
- [ ] 批次預覽顯示預估距離和時間
- [ ] 批次內訂單列表正確顯示
- [ ] 可切換不同批次（上一個/下一個）
- [ ] 點擊「接受批次」功能正常
- [ ] 批量認領成功後所有訂單移至「配送中」
- [ ] 認領後顯示順路訂單推薦（如有）
- [ ] 可選擇接受額外訂單
- [ ] 關閉推薦對話框功能正常

### 3.6 配送中訂單標籤
- [ ] 配送中標籤正確顯示
- [ ] 進行中訂單列表正確載入
- [ ] 訂單按順序排列
- [ ] 訂單卡片顯示完整資訊
- [ ] 顯示配送順序號碼
- [ ] 點擊訂單可展開詳細資訊
- [ ] 可撥打客戶電話（手機）
- [ ] 「開始導航」按鈕功能正常
- [ ] 「標記已送達」按鈕功能正常
- [ ] 「回報問題」按鈕功能正常

### 3.7 照片上傳功能
- [ ] 點擊「完成配送」觸發相機
- [ ] Web: 文件選擇器正常開啟
- [ ] RN: 相機權限請求正常
- [ ] RN: 允許權限後相機正常開啟
- [ ] 可拍攝照片
- [ ] 照片預覽正常顯示
- [ ] 可重新拍攝
- [ ] 確認上傳後照片成功傳送到後端
- [ ] 上傳進度顯示正常
- [ ] 上傳成功後訂單標記為已完成
- [ ] 上傳失敗顯示錯誤訊息
- [ ] RN: 可選擇相簿照片（如支援）

### 3.8 導航視圖
- [ ] 點擊「開始導航」開啟導航頁面
- [ ] 地圖正確載入（Web: Leaflet, RN: Google Maps）
- [ ] 當前位置標記正確顯示
- [ ] 所有訂單標記正確顯示在地圖上
- [ ] 當前訂單使用不同顏色標記（綠色）
- [ ] 其他訂單使用藍色標記
- [ ] 路線正確繪製（Polyline）
- [ ] 地圖可拖曳和縮放
- [ ] GPS 位置實時更新在地圖上
- [ ] 路線自動優化（貪心演算法）
- [ ] 底部訂單面板正確顯示
- [ ] 面板可展開/收合
- [ ] 顯示訂單詳細資訊（地址、電話、商品）
- [ ] 顯示預估距離和時間
- [ ] 「撥打電話」按鈕功能正常
- [ ] 「開啟外部導航」按鈕功能正常（呼叫 Google Maps App）
- [ ] 「完成配送」按鈕功能正常
- [ ] 「回報問題」按鈕功能正常
- [ ] 可切換到下一個訂單
- [ ] 訂單順序調整按鈕功能正常

### 3.9 訂單順序調整
- [ ] 點擊「調整順序」開啟順序調整介面
- [ ] 訂單列表正確顯示
- [ ] 顯示當前順序號碼
- [ ] 點擊「上移」按鈕功能正常
- [ ] 點擊「下移」按鈕功能正常
- [ ] 順序變化立即反映在列表上
- [ ] 點擊訂單可快速切換到該訂單
- [ ] 「重置」按鈕功能正常（恢復原始順序）
- [ ] 「確認」按鈕功能正常
- [ ] 確認後順序同步到後端
- [ ] 確認後關閉介面
- [ ] 確認後地圖路線重新計算

### 3.10 問題回報
- [ ] 點擊「回報問題」開啟問題回報對話框
- [ ] 問題描述欄位可輸入
- [ ] 「送出」按鈕功能正常
- [ ] 送出後訂單移至「問題訂單」標籤
- [ ] 送出後顯示成功訊息
- [ ] 取消按鈕功能正常

### 3.11 問題訂單標籤
- [ ] 問題訂單標籤正確顯示
- [ ] 問題訂單列表正確載入
- [ ] 訂單卡片顯示問題描述
- [ ] 可查看訂單詳細資訊
- [ ] 可重新嘗試配送
- [ ] 可聯絡客服（如有）

### 3.12 歷史記錄標籤
- [ ] 歷史記錄標籤正確顯示
- [ ] 已完成訂單列表正確載入
- [ ] 訂單按完成時間排序（最新在前）
- [ ] 訂單卡片顯示完整資訊
- [ ] 顯示完成時間
- [ ] 顯示配送證明照片（如有）
- [ ] 點擊訂單可查看詳細資訊
- [ ] 分頁功能正常（如有）
- [ ] 下拉刷新功能正常

### 3.13 離線功能（Web & RN）
- [ ] 關閉網路連線
- [ ] App 顯示離線狀態提示
- [ ] 離線時可查看已載入的訂單
- [ ] 離線時操作自動加入佇列（認領、完成、回報問題）
- [ ] 操作加入佇列後顯示「待同步」提示
- [ ] 佇列資料持久化（LocalStorage/AsyncStorage）
- [ ] 恢復網路連線
- [ ] 自動偵測網路恢復
- [ ] 自動補送佇列中的請求
- [ ] 補送成功後清除佇列
- [ ] 補送成功後顯示同步完成訊息
- [ ] 補送失敗自動重試（最多 3 次）
- [ ] 重試失敗後顯示錯誤訊息

### 3.14 推播通知（如已設定）
- [ ] 允許推播通知權限
- [ ] 新訂單時收到推播通知
- [ ] 訂單狀態變更時收到推播通知
- [ ] 點擊通知可開啟 App 並跳轉到對應訂單
- [ ] 通知內容正確（訂單號、地址等）

### 3.15 效能與體驗
- [ ] App 啟動速度快（< 3 秒）
- [ ] 頁面切換流暢
- [ ] 地圖載入順暢
- [ ] GPS 追蹤準確
- [ ] 照片上傳速度合理
- [ ] 列表滾動順暢
- [ ] 無閃退或當機
- [ ] 電池消耗合理
- [ ] 記憶體使用合理
- [ ] 無控制台錯誤（Web）/ 無 Logcat 錯誤（RN）

---

## 🔌 四、後端 API 功能測試

### 4.1 健康檢查
- [ ] `GET /api/v1/health` 回應 200
- [ ] 回應包含 status: "ok"
- [ ] 回應包含 timestamp
- [ ] 回應包含 service: "api"

### 4.2 訂單 API
- [ ] `GET /api/v1/orders` 正常取得訂單列表
- [ ] `POST /api/v1/orders` 可建立新訂單
- [ ] 建立訂單時庫存正確扣減
- [ ] 建立訂單時運費計算正確
- [ ] 建立訂單時自動判斷當日/預訂單
- [ ] 建立訂單時自動註冊 LINE 使用者（如提供 lineUserId）
- [ ] `GET /api/v1/orders/:id` 可查詢單一訂單
- [ ] `GET /api/v1/orders/search?phone={phone}` 可按電話搜尋
- [ ] `GET /api/v1/orders/:id/history` 可取得狀態歷史
- [ ] `PATCH /api/v1/orders/:id/status` 可更新訂單狀態（需權限）
- [ ] 更新狀態時自動新增歷程記錄
- [ ] 訂單建立後觸發 `order.created` 事件
- [ ] 訂單狀態變更後觸發 `order.status-changed` 事件

### 4.3 產品 API
- [ ] `GET /api/v1/products` 正常取得產品列表
- [ ] 產品列表支援 `onlyAvailable=true` 篩選
- [ ] 產品列表支援搜尋（name, category）
- [ ] 產品列表支援分類篩選
- [ ] `POST /api/v1/products` 可建立產品（需權限）
- [ ] `PATCH /api/v1/products/:id` 可更新產品（需權限）
- [ ] `PATCH /api/v1/products/:id/toggle` 可切換上架狀態

### 4.4 管理員產品 API
- [ ] `GET /admin/products` 可取得產品含統計
- [ ] `POST /admin/products/:id/image` 可上傳圖片
- [ ] 圖片上傳到 Cloudinary
- [ ] 圖片 URL 正確儲存到資料庫
- [ ] `GET /admin/products/export` 可匯出 CSV
- [ ] `POST /admin/products/import` 可匯入 CSV
- [ ] `POST /admin/products/bulk` 批量操作正常
- [ ] `POST /admin/products/reorder` 重新排序正常
- [ ] `POST /admin/products/sync-next-day-prices` 同步價格正常
- [ ] `POST /admin/products/check-price-changes` 檢查價格變動正常

### 4.5 司機 API
- [ ] `POST /api/v1/drivers/login` 司機登入正常
- [ ] 登入成功回傳 JWT Token
- [ ] `GET /api/v1/drivers/me` 可取得司機資料（需 DRIVER 權限）
- [ ] `GET /api/v1/drivers` 可列出所有司機（需 ADMIN 權限）
- [ ] `GET /api/v1/drivers/stats` 可取得統計（需 ADMIN 權限）
- [ ] `PATCH /api/v1/drivers/:id/status` 可更新司機狀態
- [ ] `PATCH /api/v1/drivers/:id/location` 可更新司機位置
- [ ] 位置更新時記錄時間戳

### 4.6 司機訂單 API
- [ ] `GET /api/v1/drivers/orders/available` 可取得可接訂單
- [ ] `GET /api/v1/drivers/orders/active` 可取得配送中訂單
- [ ] `GET /api/v1/drivers/orders/history` 可取得歷史訂單
- [ ] `GET /api/v1/drivers/orders/problem` 可取得問題訂單
- [ ] `GET /api/v1/drivers/orders/:id` 可取得訂單詳情
- [ ] `POST /api/v1/drivers/orders/:id/claim` 可認領訂單
- [ ] 認領後訂單狀態變為 preparing
- [ ] 認領後訂單指派給該司機
- [ ] `POST /api/v1/drivers/orders/batch-claim` 批量認領正常
- [ ] `POST /api/v1/drivers/orders/:id/complete` 標記已送達正常
- [ ] 完成配送時訂單狀態變為 delivered
- [ ] `POST /api/v1/drivers/orders/:id/problem` 回報問題正常
- [ ] 回報問題後訂單狀態變為 problem
- [ ] `POST /api/v1/drivers/orders/:id/proof` 上傳配送證明正常
- [ ] 配送證明儲存到資料庫
- [ ] `POST /api/v1/drivers/orders/reorder` 重新排序正常

### 4.7 批次推薦 API
- [ ] `GET /api/v1/drivers/orders/batch-recommendations` 可取得批次推薦
- [ ] 推薦批次基於地理位置計算
- [ ] 推薦批次包含預估距離和時間
- [ ] `GET /api/v1/drivers/orders/nearby-recommendations` 可取得附近推薦
- [ ] 附近推薦基於當前配送訂單計算

### 4.8 路線優化 API
- [ ] `POST /api/v1/drivers/routes/optimize` 單一訂單路線優化正常
- [ ] `POST /api/v1/drivers/routes/batch-optimize` 批量路線優化正常
- [ ] 路線優化整合 Google Maps API
- [ ] 回傳優化後的順序和距離資訊

### 4.9 配送管理 API
- [ ] `GET /admin/delivery/settings` 可取得配送設定
- [ ] `PUT /admin/delivery/settings` 可更新配送設定
- [ ] `GET /admin/delivery/map-snapshot` 可取得地圖快照
- [ ] 地圖快照包含所有線上司機位置
- [ ] 地圖快照包含待配送和配送中訂單
- [ ] `GET /admin/delivery/recommended-batches` 管理員推薦批次正常
- [ ] `POST /admin/delivery/plan-route` 規劃配送路線正常

### 4.10 認證 API
- [ ] `POST /api/v1/auth/register` 可註冊新使用者
- [ ] 註冊時密碼正確加密（bcryptjs）
- [ ] `POST /api/v1/auth/login` 可登入
- [ ] 登入成功回傳 JWT Token
- [ ] Token 包含 userId 和 role
- [ ] Token 過期時間正確設定
- [ ] 錯誤密碼無法登入

### 4.11 營業時間 API
- [ ] `GET /api/v1/business-hours` 可取得營業時間
- [ ] `PUT /api/v1/business-hours/:id` 可更新營業時間
- [ ] `POST /api/v1/business-hours/special-dates` 可新增特殊日期
- [ ] `DELETE /api/v1/business-hours/special-dates/:id` 可刪除特殊日期
- [ ] `GET /api/v1/business-hours/:year/:month` 可取得月份特殊日期

### 4.12 系統設定 API
- [ ] `GET /admin/settings/config` 可取得系統設定
- [ ] `PUT /admin/settings/config` 可更新系統設定
- [ ] 設定更新後立即生效

### 4.13 LINE Webhook
- [ ] `POST /api/v1/line/webhook` 可接收 LINE 事件
- [ ] 簽章驗證功能正常（HMAC-SHA256）
- [ ] 錯誤簽章回傳 403
- [ ] 可正確解析文字訊息
- [ ] 可識別「接受 {訂單ID}」命令
- [ ] 可識別「取消 {訂單ID}」命令
- [ ] 接受命令更新 Order.priceConfirmed = true
- [ ] 取消命令更新 Order.status = 'cancelled'
- [ ] 更新 PriceChangeAlert 記錄

### 4.14 LINE 通知事件
- [ ] 訂單建立後發送 LINE 確認訊息
- [ ] 訊息包含訂單編號（前 8 碼）
- [ ] 訊息包含配送日期
- [ ] 訊息包含訂單金額
- [ ] 訂單狀態變更後發送 LINE 通知
- [ ] 訊息包含新狀態和備註
- [ ] 價格變動後發送 LINE 通知
- [ ] 價格通知包含變動明細
- [ ] 價格通知包含接受/取消指令
- [ ] 價格通知建立 PriceChangeAlert 記錄
- [ ] 超時未回應自動接受價格

### 4.15 速率限制
- [ ] 全局速率限制生效（15 分鐘 100 次）
- [ ] 超過限制回傳 429
- [ ] 登入速率限制生效（15 分鐘 5 次）
- [ ] 訂單速率限制生效（1 分鐘 3 次）
- [ ] 開發環境速率限制更寬鬆

### 4.16 認證與授權
- [ ] 未登入時受保護端點回傳 401
- [ ] 無效 Token 回傳 401
- [ ] 過期 Token 回傳 401
- [ ] 權限不足時回傳 403
- [ ] ADMIN 可訪問管理端點
- [ ] DRIVER 可訪問司機端點
- [ ] CUSTOMER 僅可訪問客戶端點

### 4.17 錯誤處理
- [ ] 無效 UUID 回傳 400
- [ ] 資源不存在回傳 404
- [ ] 資料驗證失敗回傳 400 並包含詳細錯誤訊息
- [ ] 伺服器錯誤回傳 500
- [ ] 錯誤訊息格式一致

### 4.18 資料庫
- [ ] Prisma 連線正常
- [ ] 資料庫遷移成功
- [ ] Transaction 功能正常（訂單建立時）
- [ ] Cascade 刪除功能正常
- [ ] 索引生效（查詢速度快）

### 4.19 Cloudinary 整合
- [ ] 圖片上傳到 Cloudinary 成功
- [ ] 圖片格式轉換為 WebP
- [ ] 圖片尺寸限制為 1200x1200
- [ ] 圖片品質設定為 best
- [ ] 圖片 URL 可正常訪問
- [ ] 圖片刪除功能正常（如有）

### 4.20 Google Maps 整合
- [ ] 地址地理編碼功能正常
- [ ] 座標正確儲存到資料庫
- [ ] 距離計算功能正常
- [ ] 路線規劃功能正常
- [ ] API 配額未超出

---

## 🧪 五、整合測試

### 5.1 完整訂單流程
- [ ] 客戶在前台建立訂單
- [ ] 訂單正確儲存到資料庫
- [ ] 庫存正確扣減
- [ ] LINE 確認訊息正確發送（如已設定）
- [ ] 訂單出現在管理後台列表
- [ ] 管理員更新訂單狀態為「包裝完成」
- [ ] 狀態變更 LINE 通知發送
- [ ] 訂單出現在外送端「可接訂單」
- [ ] 外送員認領訂單
- [ ] 訂單移至外送端「配送中」
- [ ] 訂單在管理後台顯示已指派司機
- [ ] 外送員完成配送並上傳照片
- [ ] 訂單狀態變為「已送達」
- [ ] 完成 LINE 通知發送
- [ ] 客戶在訂單追蹤看到「已送達」狀態

### 5.2 預訂單價格確認流程
- [ ] 客戶在預訂時段下單
- [ ] 訂單標記為 isPreOrder = true
- [ ] 隔天管理員調整商品價格
- [ ] 管理員點擊「檢查預訂單價格變動」
- [ ] 系統計算價格變動
- [ ] 變動超過閾值觸發 LINE 通知
- [ ] 客戶收到價格變動訊息
- [ ] 訊息包含變動明細和確認指令
- [ ] 客戶回覆「接受 {訂單ID}」
- [ ] 系統更新 priceConfirmed = true
- [ ] PriceChangeAlert 記錄更新
- [ ] 訂單繼續正常配送流程
- [ ] （測試超時場景）30 分鐘未回應自動接受

### 5.3 批次配送流程
- [ ] 外送端有多個待接訂單
- [ ] 點擊「批次建議」
- [ ] 系統推薦附近訂單批次
- [ ] 批次顯示預估距離和時間
- [ ] 外送員接受批次
- [ ] 所有訂單批量認領成功
- [ ] 系統推薦額外順路訂單
- [ ] 外送員選擇接受額外訂單
- [ ] 開啟導航視圖
- [ ] 地圖顯示所有訂單標記
- [ ] 路線自動優化
- [ ] 外送員調整訂單順序
- [ ] 順序同步到後端
- [ ] 依序完成所有配送
- [ ] 所有訂單標記為已送達

### 5.4 離線同步流程
- [ ] 外送員關閉網路
- [ ] App 顯示離線狀態
- [ ] 外送員認領訂單
- [ ] 操作加入離線佇列
- [ ] 佇列持久化到本地存儲
- [ ] 恢復網路連線
- [ ] 系統自動偵測網路恢復
- [ ] 佇列中的請求自動補送
- [ ] 補送成功後訂單狀態正確更新
- [ ] 佇列清空

### 5.5 問題訂單處理流程
- [ ] 外送員配送中遇到問題
- [ ] 點擊「回報問題」
- [ ] 輸入問題描述並送出
- [ ] 訂單狀態變為 problem
- [ ] 訂單移至外送端「問題訂單」標籤
- [ ] 管理後台顯示訂單狀態為「待解決」
- [ ] 管理員查看問題描述
- [ ] 管理員聯絡客戶處理
- [ ] 管理員更新訂單狀態（重新配送或取消）

---

## 🔒 六、安全性測試

### 6.1 認證安全
- [ ] 密碼使用 bcryptjs 加密儲存
- [ ] JWT Token 使用強密鑰簽署
- [ ] Token 包含過期時間
- [ ] 登出後 Token 無法繼續使用（前端清除）
- [ ] 密碼欄位使用 type="password" 遮蔽

### 6.2 授權安全
- [ ] 未登入無法訪問受保護資源
- [ ] CUSTOMER 無法訪問管理端點
- [ ] DRIVER 無法訪問管理端點
- [ ] ADMIN 可訪問所有端點
- [ ] 司機僅能查看和操作自己的訂單

### 6.3 輸入驗證
- [ ] API 使用 Zod 驗證所有輸入
- [ ] 無效輸入回傳錯誤訊息
- [ ] SQL 注入保護（Prisma 參數化查詢）
- [ ] XSS 保護（前端自動轉義）
- [ ] CSRF 保護（如需要）

### 6.4 CORS 設定
- [ ] CORS 設定正確
- [ ] 僅允許信任的來源
- [ ] OPTIONS 請求正常處理

### 6.5 LINE Webhook 安全
- [ ] 簽章驗證功能正常
- [ ] 錯誤簽章請求被拒絕
- [ ] 使用 HTTPS
- [ ] Channel Secret 安全儲存

### 6.6 速率限制
- [ ] 速率限制防止暴力破解
- [ ] 速率限制防止 API 濫用
- [ ] 429 錯誤正確回傳

---

## ⚡ 七、效能測試

### 7.1 載入速度
- [ ] 前台首頁載入 < 3 秒
- [ ] 管理後台載入 < 3 秒
- [ ] 外送端載入 < 3 秒
- [ ] API 回應時間 < 500ms（簡單查詢）
- [ ] API 回應時間 < 2 秒（複雜查詢）

### 7.2 圖片最佳化
- [ ] 商品圖片使用 WebP 格式
- [ ] 圖片尺寸適當（1200x1200）
- [ ] 圖片品質與檔案大小平衡
- [ ] 圖片 CDN 載入快速

### 7.3 並發測試（選做）
- [ ] 10 個同時訂單可正常建立
- [ ] 5 個外送員同時認領不同訂單無衝突
- [ ] 批次認領時庫存競爭處理正確
- [ ] Transaction 保證資料一致性

### 7.4 資料量測試（選做）
- [ ] 100+ 商品列表載入正常
- [ ] 1000+ 訂單列表載入正常（分頁）
- [ ] 資料庫查詢使用索引
- [ ] 長時間運作無記憶體洩漏

---

## 📱 八、跨瀏覽器/裝置測試

### 8.1 瀏覽器相容性（Web）
- [ ] Chrome 正常運作
- [ ] Firefox 正常運作
- [ ] Safari 正常運作
- [ ] Edge 正常運作
- [ ] 行動版 Chrome 正常運作
- [ ] 行動版 Safari 正常運作

### 8.2 裝置相容性
- [ ] 桌面版（1920x1080）正常顯示
- [ ] 筆電（1366x768）正常顯示
- [ ] 平板（768x1024）正常顯示
- [ ] 手機（375x667, iPhone SE）正常顯示
- [ ] 手機（414x896, iPhone 11）正常顯示
- [ ] 手機（360x640, Android）正常顯示

### 8.3 React Native App（如已編譯）
- [ ] iOS 實體裝置正常運作
- [ ] Android 實體裝置正常運作
- [ ] 相機功能正常
- [ ] GPS 定位正常
- [ ] 推播通知正常

---

## 📊 九、資料完整性測試

### 9.1 訂單資料
- [ ] 訂單建立時所有欄位正確儲存
- [ ] 訂單金額計算正確
- [ ] 訂單項目與商品關聯正確
- [ ] 訂單狀態歷程完整記錄
- [ ] 訂單刪除時相關資料 Cascade 刪除

### 9.2 商品資料
- [ ] 商品建立時所有欄位正確儲存
- [ ] 商品選項正確關聯
- [ ] 商品圖片 URL 正確儲存
- [ ] 商品刪除時選項一起刪除
- [ ] 庫存扣減/補回正確

### 9.3 司機資料
- [ ] 司機位置更新正確儲存
- [ ] 司機狀態變更正確記錄
- [ ] 司機訂單關聯正確
- [ ] 配送證明正確關聯

### 9.4 LINE 使用者資料
- [ ] LINE 使用者自動註冊/更新
- [ ] lineUserId 唯一性約束生效
- [ ] 電話號碼正確關聯

---

## 🎯 測試統計

- **總測試項目數**：______
- **已通過項目數**：______
- **失敗項目數**：______
- **通過率**：______%

---

## 📝 測試備註

### 發現的問題
1.
2.
3.

### 建議改進
1.
2.
3.

### 需要額外測試
1.
2.
3.

---

**測試完成日期**：______
**簽名**：______
