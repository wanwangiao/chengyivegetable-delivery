# ğŸ—„ï¸ è³‡æ–™åº«é·ç§»åŸ·è¡ŒæŒ‡å—

## ğŸ“‹ ç›®æ¨™
ç‚º `orders` è¡¨æ·»åŠ  `payment_method` æ¬„ä½ï¼Œä¿®å¾©å‰å°çµå¸³åŠŸèƒ½ã€‚

## ğŸš€ åŸ·è¡Œæ–¹å¼

### æ–¹æ³•1ï¼šä½¿ç”¨ Railway CLIï¼ˆæ¨è–¦ï¼‰

å¦‚æœæ‚¨æœ‰å®‰è£ Railway CLIï¼š

```bash
# 1. é€£æ¥åˆ°è³‡æ–™åº«
railway run psql $DATABASE_URL

# 2. åŸ·è¡Œ SQL æª”æ¡ˆ
\i manual_migration.sql
```

### æ–¹æ³•2ï¼šä½¿ç”¨ psql å®¢æˆ¶ç«¯

å¦‚æœæ‚¨æœ‰å®‰è£ PostgreSQL å®¢æˆ¶ç«¯ï¼š

```bash
# Windows (éœ€è¦å®‰è£ PostgreSQL)
psql -h db-postgresql-sgp1-67006-do-user-16407903-0.c.db.ondigitalocean.com -p 25060 -U doadmin -d defaultdb -f manual_migration.sql

# æˆ–è€…è¤‡è£½è²¼ä¸ŠåŸ·è¡Œ
psql -h db-postgresql-sgp1-67006-do-user-16407903-0.c.db.ondigitalocean.com -p 25060 -U doadmin -d defaultdb
```

### æ–¹æ³•3ï¼šä½¿ç”¨ç¶²é ç‰ˆè³‡æ–™åº«ç®¡ç†å·¥å…·

1. **pgAdmin** (å¦‚æœæœ‰å®‰è£)
2. **Railway Dashboard** (å¦‚æœ Railway æä¾›è³‡æ–™åº«ç®¡ç†ä»‹é¢)
3. **DigitalOcean æ§åˆ¶å°** (å¦‚æœæœ‰æä¾›)

### æ–¹æ³•4ï¼šç›´æ¥è¤‡è£½ SQL åŸ·è¡Œ

å¦‚æœæ‚¨æœ‰ä»»ä½• PostgreSQL ç®¡ç†å·¥å…·ï¼Œç›´æ¥åŸ·è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- æ·»åŠ  payment_method æ¬„ä½
DO $$ 
BEGIN 
    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.columns 
        WHERE table_name = 'orders' 
        AND column_name = 'payment_method'
    ) THEN
        ALTER TABLE orders ADD COLUMN payment_method TEXT DEFAULT 'cash';
        UPDATE orders SET payment_method = 'cash' WHERE payment_method IS NULL;
        RAISE NOTICE 'âœ… payment_method æ¬„ä½å·²æˆåŠŸæ·»åŠ ';
    ELSE
        RAISE NOTICE 'âš ï¸ payment_method æ¬„ä½å·²å­˜åœ¨';
    END IF;
END $$;

-- å»ºç«‹ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_orders_payment_method ON orders(payment_method);
```

## ğŸ” é©—è­‰æ­¥é©Ÿ

åŸ·è¡Œå®Œæˆå¾Œï¼Œé‹è¡Œä»¥ä¸‹æŸ¥è©¢ä¾†ç¢ºèªï¼š

```sql
-- 1. æª¢æŸ¥æ¬„ä½æ˜¯å¦å­˜åœ¨
SELECT column_name, data_type, column_default 
FROM information_schema.columns 
WHERE table_name = 'orders' AND column_name = 'payment_method';

-- 2. æª¢æŸ¥ç¾æœ‰è³‡æ–™
SELECT payment_method, COUNT(*) as count 
FROM orders 
GROUP BY payment_method;
```

## âœ… é æœŸçµæœ

åŸ·è¡ŒæˆåŠŸå¾Œæ‡‰è©²çœ‹åˆ°ï¼š

1. **æ¬„ä½è³‡è¨Š**ï¼š
   - column_name: `payment_method`
   - data_type: `text`
   - column_default: `'cash'::text`

2. **è³‡æ–™åˆ†å¸ƒ**ï¼š
   - æ‰€æœ‰ç¾æœ‰è¨‚å–®çš„ `payment_method` éƒ½æ˜¯ `'cash'`

3. **é€šçŸ¥è¨Šæ¯**ï¼š
   - `âœ… payment_method æ¬„ä½å·²æˆåŠŸæ·»åŠ åˆ° orders è¡¨`

## ğŸš¨ æ³¨æ„äº‹é …

1. **å‚™ä»½**ï¼šåŸ·è¡Œå‰å»ºè­°å‚™ä»½è³‡æ–™ï¼ˆå¦‚æœæ˜¯ç”Ÿç”¢ç’°å¢ƒï¼‰
2. **æ¬Šé™**ï¼šç¢ºä¿æ‚¨æœ‰ ALTER TABLE æ¬Šé™
3. **é€£ç·š**ï¼šç¢ºä¿è³‡æ–™åº«é€£ç·šæ­£å¸¸
4. **å¯†ç¢¼**ï¼šæ‚¨éœ€è¦è³‡æ–™åº«å¯†ç¢¼æ‰èƒ½é€£æ¥

## ğŸ†˜ å¦‚æœé‡åˆ°å•é¡Œ

1. **æ¬Šé™ä¸è¶³**ï¼šè¯ç¹«è³‡æ–™åº«ç®¡ç†å“¡
2. **é€£ç·šå¤±æ•—**ï¼šæª¢æŸ¥ç¶²è·¯å’Œæ†‘è­‰
3. **SQL éŒ¯èª¤**ï¼šæª¢æŸ¥èªæ³•æˆ–è¯ç¹«æŠ€è¡“æ”¯æ´

## ğŸ“ éœ€è¦å”åŠ©ï¼Ÿ

å¦‚æœæ‚¨åœ¨åŸ·è¡Œéç¨‹ä¸­é‡åˆ°ä»»ä½•å•é¡Œï¼Œè«‹å‘Šè¨´æˆ‘ï¼š
- ä½¿ç”¨çš„åŸ·è¡Œæ–¹æ³•
- é‡åˆ°çš„éŒ¯èª¤è¨Šæ¯
- ç›®å‰çš„è³‡æ–™åº«é€£ç·šç‹€æ³