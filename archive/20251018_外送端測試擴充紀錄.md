# 2025-10-18 外送端測試擴充紀錄

**執行時間**：2025-10-18 15:40 ~ 16:50  
**負責人**：AI Assistant

---

## 🧪 自動化測試
- 新增 `tests/storage.test.cjs`，以 stub 方式驗證 `services/storage.ts` 在原生與 Web 環境的 Token 持久化邏輯。
- 建立 `tests/run-smoke.cjs` 執行器整合 smoke 測試與儲存測試，改採 esbuild 即時轉譯。
- 移除既有的 `.ts` smoke 測試檔案，改用 `.cjs` 版並確保測試期間 stub 會在執行結束後復原。
- 更新 `package.json` 中 Driver 專案的 `pnpm test` 指令，統一走新的 Node 測試流程。

## 🧰 程式更新
- 新增 `services/storage.ts` 與 `services/token-storage.ts`，支援跨平台的登入持久化。
- `offline-queue.ts` 改為 async/await 寫入共用儲存，解決原生端離線補送問題。
- `app/index.tsx` 新增推薦批次、一鍵領單、問題回報 Dialog 及初次載入憑證流程。
- README 與 `docs/delivery-routing.md` 更新對應說明，修正原本的亂碼段落。

## ✅ 測試結果
- `pnpm --filter driver test`：通過（煙霧測試 + Storage 測試）。

---

**後續建議**
1. 補強更多情境，例如批次領單、問題彈窗的互動測試。
2. 規劃實機串接測試，確認 API 實際回應與 UI 流程一致。
