# 待完成配置清單

**建立日期**: 2025-10-16 21:30
**狀態**: 🟡 等待手動操作
**預計時間**: 20-30 分鐘

---

## 📋 必須完成的配置 (2 項)

### 1️⃣ Sentry 錯誤監控設定 (約 15 分鐘)

#### 為什麼需要?
- 即時追蹤生產環境錯誤
- 自動收集 Stack Trace 和 Context
- 防止錯誤影響多個使用者

#### 操作步驟

**步驟 1: 註冊 Sentry** (5 分鐘)

1. 開啟瀏覽器前往: https://sentry.io/signup/
2. 使用 GitHub 或 Email 註冊帳號
3. 建立組織名稱: `ChengYi` 或 `誠憶鮮蔬`

**步驟 2: 建立專案** (3 分鐘)

1. 在 Sentry Dashboard 點擊 **"Create Project"**
2. 選擇平台: **Node.js**
3. 專案名稱: `chengyivegetable-api`
4. Alert 頻率: **Alert on every new issue**
5. 點擊 **"Create Project"**

**步驟 3: 取得 DSN** (1 分鐘)

1. 建立完成後會顯示 DSN
2. DSN 格式類似: `https://abc123def456@o1234567.ingest.sentry.io/7654321`
3. 複製整個 DSN 字串

**步驟 4: 設定 Railway 環境變數** (3 分鐘)

1. 開啟 Railway Dashboard: https://railway.app/
2. 選擇專案: `chengyivegetable`
3. 選擇服務: `chengyivegetable-api-production`
4. 點擊 **"Variables"** 標籤
5. 點擊 **"+ New Variable"**
6. 輸入:
   ```
   Variable Name: SENTRY_DSN
   Value: (貼上剛才複製的 DSN)
   ```
7. 點擊 **"Add"**

**步驟 5: 重新部署** (3 分鐘)

1. 在 Railway 服務頁面點擊 **"Deployments"** 標籤
2. 點擊右上角的 **"Deploy"** 按鈕
3. 或者點擊 **"Redeploy"** 最新的部署

**步驟 6: 驗證整合** (1 分鐘)

1. 部署完成後,點擊 **"View Logs"**
2. 應該會看到日誌訊息:
   ```
   Sentry initialized (environment: production)
   ```

#### 驗證命令

部署完成後,執行以下命令測試:

```bash
cd C:\chengyivegetable

# 1. 檢查環境變數是否設定
railway variables | grep SENTRY_DSN

# 2. 查看最新日誌
railway logs --tail 50

# 3. 測試觸發錯誤 (可選,需要建立測試端點)
# curl https://chengyivegetable-api-production.up.railway.app/api/v1/test-sentry
```

#### ✅ 完成標準

- [ ] Sentry 帳號已註冊
- [ ] `chengyivegetable-api` 專案已建立
- [ ] DSN 已複製
- [ ] Railway 已設定 `SENTRY_DSN` 變數
- [ ] API 服務已重新部署
- [ ] 日誌中出現 "Sentry initialized"

---

### 2️⃣ Railway 資料庫自動備份 (約 5 分鐘)

#### 為什麼需要?
- 防止資料意外遺失
- 災難恢復能力
- 符合資料保護最佳實踐

#### 操作步驟

**步驟 1: 進入 PostgreSQL 服務** (1 分鐘)

1. 開啟 Railway Dashboard: https://railway.app/
2. 選擇專案: `chengyivegetable`
3. 找到並點擊 **PostgreSQL** 服務 (不是 API 或 Web 服務)

**步驟 2: 啟用自動備份** (3 分鐘)

1. 在 PostgreSQL 服務頁面,點擊 **"Backups"** 標籤
2. 點擊 **"Enable Automatic Backups"** 按鈕
3. 設定備份排程:
   ```
   Frequency: Daily (每日)
   Time: 03:00 UTC (台灣時間 11:00)
   Retention: 7 days (保留 7 天)
   ```
4. 點擊 **"Enable"** 或 **"Save"**

**步驟 3: 手動測試備份** (1 分鐘)

1. 在 **"Backups"** 標籤中
2. 點擊 **"Create Backup Now"** 或類似按鈕
3. 等待備份完成 (約 10-30 秒)
4. 應該會看到備份列表中出現新的備份記錄

**步驟 4: 驗證備份設定** (1 分鐘)

1. 確認備份列表中有至少 1 個備份
2. 記下備份的時間戳記和大小
3. 確認 "Automatic Backups" 狀態為 **Enabled**

#### 本地備份腳本 (可選)

如果需要在本地執行手動備份:

```bash
cd C:\chengyivegetable

# 給腳本執行權限 (Git Bash 或 WSL)
chmod +x scripts/manual-backup.sh

# 執行備份
./scripts/manual-backup.sh "before_deployment_test"

# 備份檔案位置
ls -lh backups/
```

#### ✅ 完成標準

- [ ] PostgreSQL 服務已找到
- [ ] 自動備份已啟用
- [ ] 備份排程已設定 (每日 03:00 UTC)
- [ ] 保留期間已設定 (7 天)
- [ ] 已手動測試一次備份
- [ ] 備份列表中有至少 1 個成功的備份

---

## 🎯 完成後的狀態

### 安全性指標

| 項目 | 配置前 | 配置後 |
|------|--------|--------|
| 價格驗證 | ❌ | ✅ |
| 庫存控制 | ❌ | ✅ |
| API 限流 | ❌ | ✅ |
| 錯誤監控 | ⏳ | ✅ |
| 資料備份 | ⏳ | ✅ |
| LINE 整合 | ❌ | ✅ |

**完成度**: 從 67% → **100%**

---

## 📞 需要協助?

### 常見問題

**Q1: 找不到 Railway 的 PostgreSQL 服務**
A: 在專案首頁應該會看到多個服務卡片,其中一個標題為 "PostgreSQL" 或顯示資料庫圖示。

**Q2: Sentry 註冊需要信用卡嗎?**
A: 免費方案不需要信用卡。每月有 5,000 個錯誤事件的免費額度,對於小型專案足夠。

**Q3: Railway 備份會影響效能嗎?**
A: 不會。備份是在背景執行,對生產環境幾乎無影響。

**Q4: 設定完成後需要重啟服務嗎?**
A: Sentry 需要重新部署 API 服務。Railway 備份設定不需要重啟任何服務。

---

## 🔗 相關文件

- 詳細 Sentry 設定指南: `20251016_Sentry設定指南.md`
- 詳細 Railway 備份指南: `20251016_Railway備份指南.md`
- P0 任務完成報告: `20251016_2120_P0任務完成報告.md`

---

## 📅 時間規劃

| 任務 | 預計時間 | 建議時段 |
|------|----------|----------|
| Sentry 設定 | 15 分鐘 | 現在立即完成 |
| Railway 備份 | 5 分鐘 | 現在立即完成 |
| 驗證測試 | 10 分鐘 | 設定完成後 |
| **總計** | **30 分鐘** | **今天完成** |

---

## ✨ 完成後的好處

### 1. 錯誤監控 (Sentry)
- 🔍 即時發現生產環境錯誤
- 📊 追蹤錯誤趨勢和影響範圍
- 🚨 自動發送 Email/Slack 通知
- 🎯 快速定位問題根源

### 2. 資料備份 (Railway)
- 💾 每日自動備份資料庫
- 🔄 7 天內可隨時恢復
- 🛡️ 防止人為失誤造成資料遺失
- ⚡ 快速災難恢復能力

### 3. 系統穩定性
- ✅ 所有 P0 安全功能完整啟用
- ✅ 生產環境監控完善
- ✅ 資料保護機制健全
- ✅ 可安心推廣給更多使用者

---

**下一步**: 完成這 2 項配置後,系統將達到生產就緒 (Production Ready) 狀態! 🚀

**預計完成時間**: 2025-10-16 22:00 之前

---

_此文件建立後,請在完成每個檢查項目時打勾 ✅_
